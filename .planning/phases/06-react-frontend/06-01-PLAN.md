---
phase: 06-react-frontend
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/vite.config.ts
  - frontend/tsconfig.json
  - frontend/src/types/index.ts
  - frontend/src/services/api.ts
  - frontend/src/main.tsx
  - frontend/index.html
autonomous: true

must_haves:
  truths:
    - "npm run dev starts Vite dev server on port 5173"
    - "API calls to /api/* are proxied to localhost:8000"
    - "TypeScript types match backend schemas"
  artifacts:
    - path: "frontend/package.json"
      provides: "Vite + React + TypeScript dependencies"
      contains: "vite"
    - path: "frontend/vite.config.ts"
      provides: "Vite configuration with proxy"
      contains: "proxy"
    - path: "frontend/src/types/index.ts"
      provides: "TypeScript types for API"
      exports: ["JobStatus", "JobResponse", "GraphResponse", "ExtractorType"]
    - path: "frontend/src/services/api.ts"
      provides: "API service layer"
      exports: ["createExtraction", "getJobStatus", "getGraph"]
  key_links:
    - from: "frontend/src/services/api.ts"
      to: "/api/*"
      via: "fetch with proxy"
      pattern: "fetch.*\\/api\\/"
    - from: "frontend/src/types/index.ts"
      to: "src/cosmograph/api/schemas.py"
      via: "manual type mirroring"
      pattern: "JobStatus|JobResponse|GraphResponse"
---

<objective>
Initialize the React frontend project with Vite, TypeScript, and create the foundational API service layer.

Purpose: Establish the frontend project structure and type-safe API integration before building UI components.
Output: Working Vite dev server with API proxy and typed service functions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v0.2.0/ROADMAP.md
@.planning/phases/06-react-frontend/06-RESEARCH.md
@src/cosmograph/api/schemas.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Vite project</name>
  <files>
    frontend/package.json
    frontend/vite.config.ts
    frontend/tsconfig.json
    frontend/tsconfig.node.json
    frontend/index.html
    frontend/src/main.tsx
    frontend/src/App.tsx
    frontend/src/App.css
    frontend/src/vite-env.d.ts
  </files>
  <action>
Create the frontend directory and initialize a Vite + React + TypeScript project:

```bash
cd /Users/guthdx/terminal_projects/cosmograph
npm create vite@latest frontend -- --template react-ts
cd frontend
npm install
```

After scaffolding, update vite.config.ts to add the API proxy:

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
      },
    },
  },
});
```

Replace App.tsx with a minimal placeholder:

```tsx
function App() {
  return (
    <div className="app">
      <h1>Cosmograph</h1>
      <p>Document-to-Knowledge-Graph Service</p>
    </div>
  );
}

export default App;
```

Replace App.css with minimal styles:

```css
.app {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  font-family: system-ui, -apple-system, sans-serif;
}

h1 {
  margin-bottom: 8px;
}
```

Update index.html title to "Cosmograph".
  </action>
  <verify>
Run `cd frontend && npm run dev` - server starts on http://localhost:5173.
Visit page shows "Cosmograph" heading.
  </verify>
  <done>Vite dev server running with React + TypeScript, proxy configured for /api/*</done>
</task>

<task type="auto">
  <name>Task 2: Create TypeScript types</name>
  <files>frontend/src/types/index.ts</files>
  <action>
Create types directory and index.ts with types matching backend schemas (from src/cosmograph/api/schemas.py):

```typescript
// frontend/src/types/index.ts

/**
 * TypeScript types matching backend Pydantic schemas.
 * Source: src/cosmograph/api/schemas.py
 */

export type JobStatus = 'pending' | 'processing' | 'completed' | 'failed';

export type ExtractorType = 'auto' | 'legal' | 'text' | 'generic' | 'pdf' | 'llm';

export interface JobResponse {
  job_id: string;
  status: JobStatus;
  progress: number;
  total: number;
  created_at: string;
  error: string | null;
}

export interface GraphNode {
  id: string;
  label: string;
  category: string;
  description?: string;
}

export interface GraphEdge {
  source: string;
  target: string;
  label: string;
}

export interface GraphResponse {
  title: string;
  nodes: GraphNode[];
  edges: GraphEdge[];
  stats: {
    nodes: number;
    edges: number;
  };
}

export interface ErrorResponse {
  detail: string;
  error_code?: string;
}

export interface ExtractionOptions {
  extractor: ExtractorType;
  title: string;
  llmConfirmed: boolean;
}
```
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`</verify>
  <done>TypeScript types exported and match backend schema definitions</done>
</task>

<task type="auto">
  <name>Task 3: Create API service layer</name>
  <files>frontend/src/services/api.ts</files>
  <action>
Create services directory and api.ts with typed API functions:

```typescript
// frontend/src/services/api.ts

import type { JobResponse, GraphResponse, ExtractorType } from '../types';

const API_BASE = '/api';

/**
 * API Error class for handling backend error responses.
 */
export class ApiError extends Error {
  constructor(
    message: string,
    public status: number,
    public errorCode?: string
  ) {
    super(message);
    this.name = 'ApiError';
  }
}

/**
 * Create an extraction job from files.
 *
 * IMPORTANT: Do NOT set Content-Type header - browser sets it with boundary for FormData.
 */
export async function createExtraction(
  files: File[],
  extractor: ExtractorType = 'auto',
  title: string = 'Knowledge Graph',
  llmConfirmed: boolean = false
): Promise<JobResponse> {
  const formData = new FormData();
  files.forEach(file => formData.append('files', file));
  formData.append('extractor', extractor);
  formData.append('title', title);
  formData.append('llm_confirmed', String(llmConfirmed));

  const response = await fetch(`${API_BASE}/extract`, {
    method: 'POST',
    body: formData,
  });

  if (!response.ok) {
    const error = await response.json();
    throw new ApiError(
      error.detail || 'Extraction failed',
      response.status,
      error.error_code
    );
  }

  return response.json();
}

/**
 * Get the status of an extraction job.
 */
export async function getJobStatus(jobId: string): Promise<JobResponse> {
  const response = await fetch(`${API_BASE}/extract/${jobId}`);

  if (!response.ok) {
    const error = await response.json();
    throw new ApiError(
      error.detail || 'Failed to get job status',
      response.status,
      error.error_code
    );
  }

  return response.json();
}

/**
 * Get the extracted graph data.
 */
export async function getGraph(jobId: string): Promise<GraphResponse> {
  const response = await fetch(`${API_BASE}/graph/${jobId}`);

  if (!response.ok) {
    const error = await response.json();
    throw new ApiError(
      error.detail || 'Failed to get graph',
      response.status,
      error.error_code
    );
  }

  return response.json();
}

/**
 * Get the URL for downloading the HTML visualization.
 */
export function getDownloadHtmlUrl(jobId: string): string {
  return `${API_BASE}/download/${jobId}`;
}

/**
 * Get the URL for downloading the CSV ZIP archive.
 */
export function getDownloadCsvUrl(jobId: string): string {
  return `${API_BASE}/download/${jobId}/csv`;
}
```
  </action>
  <verify>
TypeScript compiles: `cd frontend && npx tsc --noEmit`
Manual test with backend running: Start backend (`uvicorn cosmograph.api.main:app`), start frontend (`npm run dev`), check network tab shows proxy working.
  </verify>
  <done>API service layer with typed functions for all extraction endpoints</done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run dev` starts without errors
2. Browser shows "Cosmograph" at http://localhost:5173
3. `cd frontend && npx tsc --noEmit` passes (no type errors)
4. frontend/src/types/index.ts exports JobStatus, JobResponse, GraphResponse, ExtractorType
5. frontend/src/services/api.ts exports createExtraction, getJobStatus, getGraph
6. vite.config.ts contains proxy configuration for /api
</verification>

<success_criteria>
- Vite dev server runs on port 5173
- API proxy configured for localhost:8000
- TypeScript types match backend schemas
- API service functions are typed and exported
</success_criteria>

<output>
After completion, create `.planning/phases/06-react-frontend/06-01-SUMMARY.md`
</output>
