---
phase: 06-react-frontend
plan: 04
type: execute
wave: 4
depends_on: [06-03]
files_modified:
  - frontend/src/components/ErrorDisplay.tsx
  - frontend/src/components/ErrorDisplay.css
  - frontend/src/App.tsx
  - traefik/dynamic/cosmograph.yml
autonomous: false

must_haves:
  truths:
    - "Error messages display clearly for failed extractions"
    - "Frontend accessible at http://cosmograph.localhost"
    - "API requests route through Traefik proxy"
  artifacts:
    - path: "frontend/src/components/ErrorDisplay.tsx"
      provides: "Reusable error display component"
      min_lines: 15
    - path: "traefik/dynamic/cosmograph.yml"
      provides: "Traefik routing configuration"
      contains: "cosmograph.localhost"
  key_links:
    - from: "traefik/dynamic/cosmograph.yml"
      to: "frontend"
      via: "loadBalancer to localhost:5173"
      pattern: "localhost:5173"
    - from: "traefik/dynamic/cosmograph.yml"
      to: "backend"
      via: "loadBalancer to localhost:8000"
      pattern: "localhost:8000"
---

<objective>
Add dedicated error handling component and configure Traefik for local development access.

Purpose: Polish error UX and enable access via cosmograph.localhost domain.
Output: Error display component and working Traefik configuration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v0.2.0/ROADMAP.md
@.planning/phases/06-react-frontend/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ErrorDisplay component</name>
  <files>
    frontend/src/components/ErrorDisplay.tsx
    frontend/src/components/ErrorDisplay.css
  </files>
  <action>
Create ErrorDisplay.tsx for consistent error presentation:

```tsx
// frontend/src/components/ErrorDisplay.tsx
import './ErrorDisplay.css';

interface ErrorDisplayProps {
  title?: string;
  message: string;
  onDismiss?: () => void;
  onRetry?: () => void;
}

/**
 * Reusable error display component.
 *
 * Shows error message with optional dismiss and retry actions.
 */
export function ErrorDisplay({ title = 'Error', message, onDismiss, onRetry }: ErrorDisplayProps) {
  return (
    <div className="error-display" role="alert">
      <div className="error-content">
        <strong className="error-title">{title}</strong>
        <p className="error-message">{message}</p>
      </div>
      {(onDismiss || onRetry) && (
        <div className="error-actions">
          {onRetry && (
            <button type="button" className="btn-retry" onClick={onRetry}>
              Try Again
            </button>
          )}
          {onDismiss && (
            <button type="button" className="btn-dismiss" onClick={onDismiss}>
              Dismiss
            </button>
          )}
        </div>
      )}
    </div>
  );
}
```

Create ErrorDisplay.css:

```css
/* frontend/src/components/ErrorDisplay.css */
.error-display {
  padding: 16px;
  background: rgba(239, 83, 80, 0.1);
  border: 1px solid #ef5350;
  border-radius: 8px;
  margin-bottom: 16px;
}

.error-content {
  margin-bottom: 12px;
}

.error-title {
  display: block;
  color: #ef5350;
  font-size: 14px;
  margin-bottom: 4px;
}

.error-message {
  margin: 0;
  color: #ffcdd2;
  font-size: 14px;
  line-height: 1.5;
}

.error-actions {
  display: flex;
  gap: 8px;
}

.btn-retry {
  padding: 8px 16px;
  font-size: 13px;
  background: #ef5350;
  border: none;
  border-radius: 4px;
  color: #fff;
  cursor: pointer;
}

.btn-retry:hover {
  background: #e53935;
}

.btn-dismiss {
  padding: 8px 16px;
  font-size: 13px;
  background: transparent;
  border: 1px solid #666;
  border-radius: 4px;
  color: #aaa;
  cursor: pointer;
}

.btn-dismiss:hover {
  border-color: #888;
  color: #ccc;
}
```

Update App.tsx to use ErrorDisplay component (replace inline error):

In the section where errors are displayed, replace:

```tsx
{isFailed && extraction.error && (
  <section className="error-section">
    <div className="error-message">
      <strong>Error:</strong> {extraction.error}
    </div>
  </section>
)}
```

With:

```tsx
{isFailed && extraction.error && (
  <section className="error-section">
    <ErrorDisplay
      title="Extraction Failed"
      message={extraction.error}
      onRetry={handleStartExtraction}
      onDismiss={() => extraction.reset()}
    />
  </section>
)}
```

Add the import at the top of App.tsx:

```tsx
import { ErrorDisplay } from './components/ErrorDisplay';
```

Remove the `.error-message` CSS from App.css since ErrorDisplay handles it.
  </action>
  <verify>
`cd frontend && npx tsc --noEmit` passes.
Error displays correctly when extraction fails.
Retry and dismiss buttons work.
  </verify>
  <done>ErrorDisplay component with retry and dismiss actions</done>
</task>

<task type="auto">
  <name>Task 2: Create Traefik configuration</name>
  <files>traefik/dynamic/cosmograph.yml</files>
  <action>
First, check if ~/terminal_projects/claude_code/traefik exists and understand its structure:

```bash
ls -la ~/terminal_projects/claude_code/traefik/
ls -la ~/terminal_projects/claude_code/traefik/dynamic/ 2>/dev/null || echo "No dynamic dir"
```

Create the Traefik dynamic configuration file for cosmograph.localhost. The file path depends on the existing Traefik setup.

If Traefik uses a file provider with a dynamic directory, create:

```yaml
# ~/terminal_projects/claude_code/traefik/dynamic/cosmograph.yml
# OR /Users/guthdx/terminal_projects/cosmograph/traefik/dynamic/cosmograph.yml

http:
  routers:
    # Frontend router - serves the React app
    cosmograph-frontend:
      rule: "Host(`cosmograph.localhost`) && !PathPrefix(`/api`)"
      service: cosmograph-frontend
      entrypoints:
        - web

    # API router - proxies to FastAPI backend
    cosmograph-api:
      rule: "Host(`cosmograph.localhost`) && PathPrefix(`/api`)"
      service: cosmograph-api
      entrypoints:
        - web

  services:
    cosmograph-frontend:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:5173"

    cosmograph-api:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8000"
```

Note: Use `host.docker.internal` if Traefik runs in Docker, or `localhost` if Traefik runs natively.

If Traefik is not set up or the exact location is unclear, create the configuration in the cosmograph project directory for reference:

```bash
mkdir -p /Users/guthdx/terminal_projects/cosmograph/traefik/dynamic
```

Then create the file at `/Users/guthdx/terminal_projects/cosmograph/traefik/dynamic/cosmograph.yml`.

Add a note to CLAUDE.md about activating this configuration.
  </action>
  <verify>
Traefik config file exists with correct routing rules.
If Traefik is running, verify http://cosmograph.localhost shows frontend.
  </verify>
  <done>Traefik configuration created for cosmograph.localhost routing</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete React frontend for Cosmograph with:
- File upload (drag & drop + file picker)
- Extraction options (method selection, title, LLM confirmation)
- Real-time progress display via SSE
- Graph visualization in iframe
- HTML and CSV download buttons
- Error handling with retry/dismiss
- Traefik configuration for cosmograph.localhost
  </what-built>
  <how-to-verify>
1. Start the backend:
   ```bash
   cd /Users/guthdx/terminal_projects/cosmograph
   source .venv/bin/activate
   uvicorn cosmograph.api.main:app --reload
   ```

2. Start the frontend:
   ```bash
   cd /Users/guthdx/terminal_projects/cosmograph/frontend
   npm run dev
   ```

3. Visit http://localhost:5173

4. Test the full flow:
   a. Drag & drop or select a .txt file (e.g., a CRST code file if available)
   b. Select "Legal Documents" extractor
   c. Enter a custom title
   d. Click "Start Extraction"
   e. Watch progress bar update
   f. Verify graph displays in iframe
   g. Click "Download HTML" - verify file downloads
   h. Click "Download CSV" - verify ZIP downloads
   i. Click "New Extraction" - verify UI resets

5. Test error handling:
   a. Try extracting with no backend running
   b. Verify error message displays
   c. Verify "Try Again" and "Dismiss" buttons work

6. Test LLM confirmation:
   a. Select "AI (Claude)" from extractor dropdown
   b. Verify confirmation dialog appears
   c. Cancel should keep previous selection
   d. Confirm should enable LLM extraction

7. (Optional) If Traefik is running:
   - Visit http://cosmograph.localhost
   - Verify frontend loads
   - Verify API calls work
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` passes
2. `cd frontend && npm run dev` starts without errors
3. Full extraction flow works end-to-end
4. Error display component shows with retry/dismiss
5. Traefik config file exists
6. (If Traefik running) cosmograph.localhost accessible
</verification>

<success_criteria>
- Error messages display clearly with retry option
- Traefik configuration created for cosmograph.localhost
- Human verification confirms:
  - Full upload -> progress -> results flow works
  - Download buttons produce correct files
  - Error handling works appropriately
  - LLM confirmation gate functions
</success_criteria>

<output>
After completion, create `.planning/phases/06-react-frontend/06-04-SUMMARY.md`
</output>
