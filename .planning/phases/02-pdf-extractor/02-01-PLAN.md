---
phase: 02-pdf-extractor
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cosmograph/extractors/pdf.py
  - src/cosmograph/extractors/__init__.py
autonomous: true

must_haves:
  truths:
    - "PdfExtractor can extract text from valid PDF files"
    - "PdfExtractor rejects encrypted PDFs with clear error message"
    - "PdfExtractor detects scanned PDFs and provides informative message"
    - "PdfExtractor preserves reading order from multi-page documents"
  artifacts:
    - path: "src/cosmograph/extractors/pdf.py"
      provides: "PdfExtractor class inheriting BaseExtractor"
      min_lines: 60
      exports: ["PdfExtractor"]
    - path: "src/cosmograph/extractors/__init__.py"
      provides: "Module exports including PdfExtractor"
      contains: "PdfExtractor"
  key_links:
    - from: "src/cosmograph/extractors/pdf.py"
      to: "src/cosmograph/extractors/base.py"
      via: "class inheritance"
      pattern: "class PdfExtractor\\(BaseExtractor\\)"
    - from: "src/cosmograph/extractors/pdf.py"
      to: "src/cosmograph/extractors/legal.py"
      via: "text processing delegation"
      pattern: "LegalDocumentExtractor"
---

<objective>
Create PdfExtractor class that extracts entities from PDF documents.

Purpose: Enable PDF document processing to satisfy FR-1 requirements. PDFs are the most common client document format.

Output: Working `PdfExtractor` class that handles text extraction, error cases (encrypted/scanned), and delegates entity extraction to existing extractors.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-pdf-extractor/02-RESEARCH.md
@src/cosmograph/extractors/base.py
@src/cosmograph/extractors/legal.py
@src/cosmograph/extractors/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PdfExtractor class</name>
  <files>src/cosmograph/extractors/pdf.py</files>
  <action>
Create `src/cosmograph/extractors/pdf.py` with PdfExtractor class:

1. Import `pymupdf` (NOT `fitz` - legacy name)
2. Inherit from `BaseExtractor`
3. Implement `supports()` - return True for `.pdf` suffix
4. Implement `extract()`:
   - Open PDF with `pymupdf.open(filepath)`
   - Check `doc.needs_pass` for encrypted PDFs -> raise ValueError with clear message
   - Extract text from all pages with `page.get_text(sort=True)` for reading order
   - Check for scanned PDF using `_is_likely_scanned()` heuristic -> raise ValueError
   - Delegate entity extraction to `LegalDocumentExtractor._extract_*` methods by:
     a. Creating a LegalDocumentExtractor instance with same graph
     b. Calling its internal extraction methods with the extracted text
   - Always close document in finally block
5. Implement `_is_likely_scanned()` heuristic:
   - If extracted text > 100 chars, return False (has text)
   - Check for full-page images with < 50 chars text -> return True
   - Return True if text < 20 chars total

Key patterns from research:
- Use `for page in doc:` iterator (not index-based)
- Use `sort=True` parameter for reading order
- Use try/finally to ensure doc.close()

Error messages should be user-friendly:
- Encrypted: "PDF is password-protected: {filename}"
- Scanned: "PDF appears to be scanned (no extractable text): {filename}"
  </action>
  <verify>
```bash
# Verify file exists and has correct structure
python -c "from cosmograph.extractors.pdf import PdfExtractor; print('Import OK')"
python -c "from cosmograph.extractors.pdf import PdfExtractor; e = PdfExtractor(); print(f'supports .pdf: {e.supports(__import__(\"pathlib\").Path(\"test.pdf\"))}')"
```
  </verify>
  <done>PdfExtractor class exists with supports(), extract(), and _is_likely_scanned() methods</done>
</task>

<task type="auto">
  <name>Task 2: Export PdfExtractor from module</name>
  <files>src/cosmograph/extractors/__init__.py</files>
  <action>
Update `src/cosmograph/extractors/__init__.py`:

1. Add import: `from .pdf import PdfExtractor`
2. Add `PdfExtractor` to `__all__` list

Maintain alphabetical ordering of imports and exports.
  </action>
  <verify>
```bash
python -c "from cosmograph.extractors import PdfExtractor; print('Module export OK')"
```
  </verify>
  <done>PdfExtractor is importable from cosmograph.extractors package</done>
</task>

</tasks>

<verification>
```bash
# Verify complete integration
python -c "
from cosmograph.extractors import PdfExtractor, BaseExtractor
from pathlib import Path

# Check inheritance
assert issubclass(PdfExtractor, BaseExtractor), 'Must inherit BaseExtractor'

# Check methods exist
e = PdfExtractor()
assert hasattr(e, 'supports'), 'Missing supports method'
assert hasattr(e, 'extract'), 'Missing extract method'
assert hasattr(e, '_is_likely_scanned'), 'Missing scanned detection'

# Check file support
assert e.supports(Path('doc.pdf')), 'Should support .pdf'
assert not e.supports(Path('doc.txt')), 'Should not support .txt'

print('All verification checks passed')
"
```
</verification>

<success_criteria>
- PdfExtractor class exists in src/cosmograph/extractors/pdf.py
- Class properly inherits from BaseExtractor
- supports() returns True for .pdf files only
- extract() method handles: valid PDFs, encrypted PDFs (ValueError), scanned PDFs (ValueError)
- PdfExtractor importable from cosmograph.extractors
- Code follows project conventions (type hints, docstrings, ruff-compliant)
</success_criteria>

<output>
After completion, create `.planning/phases/02-pdf-extractor/02-01-SUMMARY.md`
</output>
